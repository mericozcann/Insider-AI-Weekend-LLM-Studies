# -*- coding: utf-8 -*-
"""RhoRisk-MeriÃ§ | Web-Augmented Financial Risk LLM Pipeline

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/10SEf6aLvxPk5AcpCFPDGF-_2hYWHMQIp
"""

# ================================
# RhoRisk-MeriÃ§ â€“ Full Colab Pipeline (FINAL)
# Web-Augmented Financial Risk LLM (TinyLlama + LoRA + RAG + Gradio)
# ================================

# --------- [1] KURULUM ---------
!pip install -q transformers accelerate peft bitsandbytes datasets
!pip install -q langchain langchain-community faiss-cpu duckduckgo-search sentence-transformers gradio ddgs

# Kurulumdan sonra:
# Runtime â†’ Restart runtime
# Restart sonrasÄ± bu hÃ¼creyi tekrar Ã‡ALIÅTIRMA.
# AÅŸaÄŸÄ±daki kodlarÄ± yeni hÃ¼crelere bÃ¶lÃ¼p sÄ±rayla Ã§alÄ±ÅŸtÄ±r.


# --------- [2] MODEL + TOKENIZER + LoRA + 4-BIT ---------
import torch
from transformers import AutoModelForCausalLM, AutoTokenizer, BitsAndBytesConfig
from peft import LoraConfig, get_peft_model

BASE_MODEL_ID = "TinyLlama/TinyLlama-1.1B-Chat-v1.0"

tokenizer = AutoTokenizer.from_pretrained(BASE_MODEL_ID)
if tokenizer.pad_token is None:
    tokenizer.pad_token = tokenizer.eos_token

bnb_config = BitsAndBytesConfig(
    load_in_4bit=True,
    bnb_4bit_compute_dtype=torch.float16,
    bnb_4bit_use_double_quant=True,
    bnb_4bit_quant_type="nf4"
)

model = AutoModelForCausalLM.from_pretrained(
    BASE_MODEL_ID,
    device_map="auto",
    quantization_config=bnb_config
)

SYSTEM_PROMPT = (
    "You are RhoRisk-MeriÃ§, a bilingual Turkishâ€“English AI assistant specialized ONLY in financial risk analytics. "
    "You answer questions related to credit risk, market risk, liquidity risk, operational risk, model risk, "
    "systemic risk, Basel regulations, stress testing and financial fraud. "
    "For non-financial topics you politely redirect to financial risk topics."
)

lora_config = LoraConfig(
    r=16,
    lora_alpha=32,
    target_modules=["q_proj", "k_proj", "v_proj", "o_proj", "gate_proj", "up_proj", "down_proj"],
    lora_dropout=0.05,
    bias="none",
    task_type="CAUSAL_LM"
)

model = get_peft_model(model, lora_config)
model.print_trainable_parameters()

print("âœ… RhoRisk-MeriÃ§ model + LoRA + 4-bit hazÄ±r.")


# --------- [3] TEMEL LLM CEVAP FONKSÄ°YONU ---------
def llm_answer(prompt, max_new_tokens=256, temperature=0.7, top_p=0.9):
    inputs = tokenizer(prompt, return_tensors="pt").to(model.device)

    with torch.no_grad():
        outputs = model.generate(
            **inputs,
            max_new_tokens=max_new_tokens,
            temperature=temperature,
            top_p=top_p,
            pad_token_id=tokenizer.eos_token_id
        )

    return tokenizer.decode(outputs[0], skip_special_tokens=True)

# HÄ±zlÄ± test:
test_prompt = f"{SYSTEM_PROMPT}\n\nUser: Finansal risk tÃ¼rlerini kÄ±saca aÃ§Ä±klar mÄ±sÄ±n?\nAssistant:"
print(llm_answer(test_prompt)[:400])


# --------- [4] LANGCHAIN + DUCKDUCKGO + FAISS (RAG) ---------
from langchain_community.utilities import DuckDuckGoSearchAPIWrapper
from langchain_community.embeddings import HuggingFaceEmbeddings
from langchain_community.vectorstores import FAISS
from langchain_core.documents import Document

search = DuckDuckGoSearchAPIWrapper()
embedder = HuggingFaceEmbeddings(model_name="sentence-transformers/all-MiniLM-L6-v2")
vector_db = FAISS.from_texts(["initial"], embedder)

print("âœ… LangChain RAG altyapÄ±sÄ± hazÄ±r.")


# --------- [5] WEBâ€™DEN BÄ°LGÄ° Ã‡EKME ---------
def web_retrieve(query, k=3):
    results = search.results(query, max_results=8)

    texts = []
    for r in results:
        snippet = r.get("snippet", "")
        title = r.get("title", "")
        link = r.get("link", "")
        combined = f"{title}\n{snippet}\n{link}"
        texts.append(combined)

    global vector_db
    vector_db.add_texts(texts)
    docs = vector_db.similarity_search(query, k=k)
    return docs

# Test:
docs_test = web_retrieve("Basel III capital requirements overview")
print("ğŸ” Ã–rnek dokÃ¼man:\n", docs_test[0].page_content[:300])


# --------- [6] RAG + LLM BÄ°RLEÅÄ°MÄ° ---------
def build_rag_prompt(user_question, context_text):
    prompt = f"""
{SYSTEM_PROMPT}

Below is some external, real-world information retrieved from the web.
Use it ONLY as supporting material.

[WEB CONTEXT]
{context_text}
[END OF CONTEXT]

User question:
{user_question}

As RhoRisk-MeriÃ§, provide a clear, professional answer focused on FINANCIAL RISK.
Answer in the same language as the question.
Assistant:
"""
    return prompt


def risk_rag_chat(user_question):
    docs = web_retrieve(user_question, k=3)
    context = "\n\n---\n\n".join([d.page_content for d in docs])

    prompt = build_rag_prompt(user_question, context)
    answer_full = llm_answer(prompt, max_new_tokens=320, temperature=0.6, top_p=0.9)

    if "Assistant:" in answer_full:
        answer = answer_full.split("Assistant:")[-1].strip()
    else:
        answer = answer_full.strip()

    return answer

# Test:
print(risk_rag_chat("Basel III kapsamÄ±nda piyasa riski iÃ§in getirilen baÅŸlÄ±ca yenilikler nelerdir?")[:600])


# --------- [7] GRADIO CHAT ARAYÃœZÃœ ---------
import gradio as gr

def chat_ui(message):
    if not message or message.strip() == "":
        return "LÃ¼tfen finansal risk ile ilgili bir soru yaz."
    return risk_rag_chat(message)

app = gr.Interface(
    fn=chat_ui,
    inputs=gr.Textbox(label="Financial Risk Question", placeholder="Ã–rn: Basel III'e gÃ¶re likidite riski nasÄ±l Ã¶lÃ§Ã¼lÃ¼r?"),
    outputs=gr.Textbox(label="RhoRisk-MeriÃ§ Answer"),
    title="RhoRisk-MeriÃ§ â€“ Web-Augmented Financial Risk LLM",
    description="Ask about credit risk, market risk, Basel, VaR, stress testing, liquidity and fraud."
)

app.launch(share=True)


# --------- [8] LoRA FINE-TUNE Ä°SKELETÄ° â€“ KAVRAM + SENARYO TABANLI FÄ°NANSAL RÄ°SK Q&A ---------
from datasets import Dataset
import random

def build_training_example(user, assistant):
    text = (
        f"<|system|>\n{SYSTEM_PROMPT}\n"
        f"<|user|>\n{user}\n"
        f"<|assistant|>\n{assistant}"
    )
    return {"text": text}

# 1) Ã‡EKÄ°RDEK (SEED) KAVRAM BAZLI FÄ°NANSAL RÄ°SK BÄ°LGÄ°LERÄ°
concept_seeds = [
    ("Kredi riski",
     "Kredi riski, borÃ§lunun yÃ¼kÃ¼mlÃ¼lÃ¼klerini zamanÄ±nda ve tam olarak yerine getirememe ihtimalidir. "
     "Bankalar PD, LGD ve EAD modelleri, limit yÃ¶netimi, teminatlandÄ±rma ve portfÃ¶y Ã§eÅŸitlendirmesi ile bu riski yÃ¶netir."),
    ("PD, LGD ve EAD",
     "PD temerrÃ¼t olasÄ±lÄ±ÄŸÄ±nÄ±, LGD temerrÃ¼t gerÃ§ekleÅŸtiÄŸinde kayÄ±p oranÄ±nÄ±, EAD ise temerrÃ¼t anÄ±ndaki maruziyeti ifade eder. "
     "Beklenen kredi zararÄ± genellikle EL = PD Ã— LGD Ã— EAD formÃ¼lÃ¼yle hesaplanÄ±r."),
    ("Piyasa riski",
     "Piyasa riski, faiz oranlarÄ±, dÃ¶viz kurlarÄ±, hisse senedi ve emtia fiyatlarÄ±ndaki deÄŸiÅŸimlerden kaynaklanan kayÄ±p riskidir."),
    ("VaR (Value at Risk)",
     "VaR, belirli bir zaman diliminde ve belirli bir gÃ¼ven seviyesinde beklenen maksimum kaybÄ± Ã¶lÃ§er ve piyasa riski iÃ§in yaygÄ±n olarak kullanÄ±lÄ±r."),
    ("Expected Shortfall",
     "Expected Shortfall, VaR seviyesinin Ã¶tesindeki ortalama kaybÄ± Ã¶lÃ§er ve kuyruk riskini daha iyi yakaladÄ±ÄŸÄ± iÃ§in daha tutarlÄ± bir risk Ã¶lÃ§Ã¼sÃ¼dÃ¼r."),
    ("Likidite riski",
     "Likidite riski, kÄ±sa vadeli yÃ¼kÃ¼mlÃ¼lÃ¼klerin zamanÄ±nda karÅŸÄ±lanamamasÄ± riskidir. LCR ve NSFR bu riski Ã¶lÃ§mek iÃ§in kullanÄ±lÄ±r."),
    ("LCR (Likidite KarÅŸÄ±lama OranÄ±)",
     "LCR, yÃ¼ksek kaliteli likit varlÄ±klarÄ±n 30 gÃ¼nlÃ¼k stres altÄ±ndaki net nakit Ã§Ä±kÄ±ÅŸlarÄ±nÄ± karÅŸÄ±lama kabiliyetini Ã¶lÃ§er ve en az %100 olmasÄ± hedeflenir."),
    ("NSFR (Net Stable Funding Ratio)",
     "NSFR, bir yÄ±llÄ±k ufukta mevcut istikrarlÄ± fonlamanÄ±n gereken istikrarlÄ± fonlamaya oranÄ±nÄ± Ã¶lÃ§erek, daha uzun vadeli fonlamayÄ± teÅŸvik eder."),
    ("Operasyonel risk",
     "Operasyonel risk, sÃ¼reÃ§ler, insanlar, sistemler ve dÄ±ÅŸ olaylardan kaynaklanan kayÄ±p riskidir. DolandÄ±rÄ±cÄ±lÄ±k, BT arÄ±zalarÄ± ve insan hatalarÄ± tipik Ã¶rneklerdir."),
    ("Model riski",
     "Model riski, hatalÄ± varsayÄ±mlar, veri sorunlarÄ± veya yanlÄ±ÅŸ kullanÄ±m nedeniyle modellerin yanlÄ±ÅŸ sonuÃ§ Ã¼retmesi riskidir."),
    ("Sistemik risk",
     "Sistemik risk, bir kurum veya piyasadaki ÅŸoklarÄ±n, aÄŸ etkileri ve bulaÅŸma kanallarÄ±yla finansal sistemin geneline yayÄ±lmasÄ± riskidir."),
    ("Basel III",
     "Basel III, sermaye yeterliliÄŸi, kaldÄ±raÃ§ oranÄ± ve likidite oranlarÄ±na iliÅŸkin kÃ¼resel bankacÄ±lÄ±k standartlarÄ±nÄ± belirleyen dÃ¼zenleyici Ã§erÃ§evedir."),
    ("FRTB (Fundamental Review of the Trading Book)",
     "FRTB, Basel III kapsamÄ±nda piyasa riski sermaye gereksinimlerini yeniden tanÄ±mlayan Ã§erÃ§evedir; VaR yerine Expected Shortfall kullanÄ±mÄ± Ã¶ne Ã§Ä±kar."),
    ("IFRS 9 ve beklenen kredi zararÄ±",
     "IFRS 9, beklenen kredi zararÄ± (ECL) yaklaÅŸÄ±mÄ±nÄ± getirerek, PD, LGD ve EAD'ye dayalÄ± ileriye dÃ¶nÃ¼k karÅŸÄ±lÄ±k hesaplamasÄ±nÄ± zorunlu kÄ±lar."),
    ("Stres testi",
     "Stres testi, makroekonomik veya piyasa ÅŸok senaryolarÄ± altÄ±nda sermaye, likidite ve kÃ¢rlÄ±lÄ±k Ã¼zerindeki etkileri Ã¶lÃ§mek iÃ§in kullanÄ±lÄ±r."),
    ("KarÅŸÄ± taraf kredi riski",
     "KarÅŸÄ± taraf kredi riski, Ã¶zellikle tÃ¼rev iÅŸlemlerde, sÃ¶zleÅŸme sÃ¼resi boyunca karÅŸÄ± tarafÄ±n yÃ¼kÃ¼mlÃ¼lÃ¼klerini yerine getirememe riskidir."),
    ("Wrong-way risk",
     "Wrong-way risk, maruziyet ile karÅŸÄ± tarafÄ±n kredi kalitesi arasÄ±nda olumsuz korelasyon olduÄŸunda ortaya Ã§Ä±kar; maruziyet artarken kredi kalitesi bozulur."),
    ("Risk iÅŸtahÄ±",
     "Risk iÅŸtahÄ±, bir kurumun stratejik hedeflerine ulaÅŸmak iÃ§in kabul etmeye hazÄ±r olduÄŸu toplam risk seviyesidir."),
    ("Konsantrasyon riski",
     "Konsantrasyon riski, portfÃ¶yÃ¼n tek bir mÃ¼ÅŸteri, sektÃ¶r veya Ã¼lkeye aÅŸÄ±rÄ± odaklanmasÄ± nedeniyle Ã§eÅŸitlendirme etkisinin zayÄ±flamasÄ± riskidir."),
    ("Fraud (finansal dolandÄ±rÄ±cÄ±lÄ±k) riski",
     "Finansal dolandÄ±rÄ±cÄ±lÄ±k riski, sahte veya yanÄ±ltÄ±cÄ± iÅŸlemler nedeniyle kayÄ±p yaÅŸanmasÄ± riskidir. Anomali tespiti ve davranÄ±ÅŸsal modeller bu alanda kullanÄ±lÄ±r."),
    ("Explainable AI (XAI) ve fraud",
     "XAI, dolandÄ±rÄ±cÄ±lÄ±k tespit modellerinde hangi Ã¶zelliklerin kararÄ± tetiklediÄŸini aÃ§Ä±klamaya yardÄ±mcÄ± olur ve dÃ¼zenleyici uyumu destekler."),
    ("PIT ve TTC PD",
     "PIT PD, mevcut ekonomik koÅŸullarÄ± yansÄ±tan temerrÃ¼t olasÄ±lÄ±ÄŸÄ±nÄ±; TTC PD ise dÃ¶ngÃ¼ boyunca ortalama temerrÃ¼t olasÄ±lÄ±ÄŸÄ±nÄ± ifade eder."),
    ("ICAAP",
     "ICAAP, bankanÄ±n iÃ§sel sermaye yeterliliÄŸi deÄŸerlendirme sÃ¼recidir ve risk profili, strateji ve stres testlerini entegre eder.")
]

concept_question_templates = [
    "Nedir ve neden Ã¶nemlidir: {topic}?",
    "{topic} kavramÄ±nÄ± teknik olarak aÃ§Ä±klar mÄ±sÄ±n?",
    "{topic} finansal risk yÃ¶netiminde nasÄ±l kullanÄ±lÄ±r?",
    "{topic} iÃ§in tipik bir banka Ã¶rneÄŸi verebilir misin?",
    "Basel Ã§erÃ§evesinde {topic} nasÄ±l ele alÄ±nÄ±r?",
    "{topic} yanlÄ±ÅŸ yÃ¶netilirse ne tÃ¼r kayÄ±plar oluÅŸabilir?",
    "{topic} hangi metriklerle Ã¶lÃ§Ã¼lÃ¼r veya izlenir?",
    "Risk komitesine sunum yapÄ±yormuÅŸsun gibi {topic} konusunu Ã¶zetler misin?",
    "{topic} ile ilgili sÄ±k yapÄ±lan hatalar nelerdir?",
    "{topic} ile iliÅŸkili diÄŸer risk tÃ¼rleri hangileridir?"
]

# 2) SENARYO BAZLI SEEDâ€™LER (KRÄ°Z, ÅOK, FRAUD, VB.)
scenario_seeds = [
    ("ani faiz artÄ±ÅŸÄ± senaryosu",
     "Ani faiz artÄ±ÅŸÄ± senaryosunda, sabit faizli menkul kÄ±ymetlerin deÄŸeri dÃ¼ÅŸer, faiz riski artar ve uzun vade tahvil portfÃ¶yleri ciddi piyasa riski taÅŸÄ±r. "
     "AyrÄ±ca, faiz artÄ±ÅŸlarÄ±na duyarlÄ± sektÃ¶rlerde kredi temerrÃ¼tleri artabilir."),
    ("kur ÅŸoku ve devalÃ¼asyon senaryosu",
     "Kur ÅŸoku senaryosunda, dÃ¶viz aÃ§Ä±k pozisyonu olan kurumlar ve dÃ¶viz geliri olmayan borÃ§lular ciddi zararlar yaÅŸayabilir. "
     "FX riski, kredi riski ve likidite riski aynÄ± anda tetiklenebilir."),
    ("likidite sÄ±kÄ±ÅŸÄ±klÄ±ÄŸÄ± ve piyasa kurumasÄ±",
     "Likidite sÄ±kÄ±ÅŸÄ±klÄ±ÄŸÄ±nda piyasada alÄ±cÄ± bulmak zorlaÅŸÄ±r, bid-ask spread'ler aÃ§Ä±lÄ±r ve varlÄ±klarÄ± makul fiyattan satmak gÃ¼Ã§leÅŸir. "
     "Bu durum hem likidite hem de piyasa riskini artÄ±rÄ±r."),
    ("bÃ¼yÃ¼k bir bankanÄ±n iflasÄ±",
     "Sistemik Ã¶neme sahip bir bankanÄ±n iflasÄ±, karÅŸÄ± taraf kredi riski, gÃ¼ven kaybÄ± ve mevduat Ã§Ä±kÄ±ÅŸlarÄ± yoluyla zincirleme etki yaratabilir. "
     "Ã–demeler sistemi ve finansal istikrar Ã¼zerinde ciddi etkileri olur."),
    ("yaygÄ±n bir kredi temerrÃ¼t dalgasÄ±",
     "Ekonomik resesyon veya sektÃ¶r ÅŸoku sÄ±rasÄ±nda geniÅŸ Ã§aplÄ± kredi temerrÃ¼tleri yaÅŸanabilir. "
     "Bu durumda PD'ler artar, LGD yÃ¼kselir ve bankalarÄ±n sermaye oranlarÄ± hÄ±zla eriyebilir."),
    ("bÃ¼yÃ¼k bir iÃ§ dolandÄ±rÄ±cÄ±lÄ±k vakasÄ±",
     "BÃ¼yÃ¼k bir iÃ§ dolandÄ±rÄ±cÄ±lÄ±k vakasÄ±, operasyonel riskin gerÃ§ekleÅŸmiÅŸ bir Ã¶rneÄŸidir. "
     "Finansal kaybÄ±n yanÄ±nda itibar kaybÄ±, regÃ¼lasyon cezalarÄ± ve risk kÃ¼ltÃ¼rÃ¼ sorgulamasÄ± gÃ¼ndeme gelir."),
    ("siber saldÄ±rÄ± ve sistem kesintisi",
     "Siber saldÄ±rÄ±lar, operasyonel risk kapsamÄ±nda ele alÄ±nÄ±r ve kritik sistemlerin durmasÄ±na, mÃ¼ÅŸteri verisi ihlaline ve finansal kayÄ±plara yol aÃ§abilir."),
    ("Ã¼lke notunun dÃ¼ÅŸÃ¼rÃ¼lmesi (sovereign downgrade)",
     "Ãœlke notunun dÃ¼ÅŸÃ¼rÃ¼lmesi, kamu borÃ§lanma maliyetlerini artÄ±rÄ±r, bankalarÄ±n devlet tahvili portfÃ¶yÃ¼nde deÄŸer kayÄ±plarÄ±na ve fonlama maliyetlerinde artÄ±ÅŸa neden olabilir."),
    ("emlak balonunun patlamasÄ±",
     "Emlak balonunun patlamasÄ±, teminat deÄŸeri olarak kullanÄ±lan gayrimenkullerin fiyatÄ±nÄ± dÃ¼ÅŸÃ¼rÃ¼r, LGD'yi artÄ±rÄ±r ve mortgage portfÃ¶ylerinde kredi riski sorunlarÄ± yaratÄ±r."),
    ("kÃ¼resel risk iÅŸtahÄ±nÄ±n ani dÃ¼ÅŸmesi",
     "KÃ¼resel risk iÅŸtahÄ±nÄ±n ani dÃ¼ÅŸmesi, geliÅŸmekte olan Ã¼lke varlÄ±klarÄ±ndan Ã§Ä±kÄ±ÅŸa, CDS spreadlerinde geniÅŸlemeye ve fonlama maliyetlerinde artÄ±ÅŸa yol aÃ§abilir.")
]

scenario_question_templates = [
    "{scenario} durumunda hangi ana risk tÃ¼rleri tetiklenir ve nasÄ±l?",
    "{scenario} senaryosunda kredi riski nasÄ±l etkilenir?",
    "{scenario} senaryosunda piyasa riski ve likidite riski iliÅŸkisini aÃ§Ä±klar mÄ±sÄ±n?",
    "{scenario} iÃ§in Ã¶rnek bir stres testi kurgular mÄ±sÄ±n?",
    "{scenario} yaÅŸandÄ±ÄŸÄ±nda hangi erken uyarÄ± gÃ¶stergeleri takip edilmelidir?",
    "{scenario} sonrasÄ±nda sermaye yeterliliÄŸi Ã¼zerindeki etkiler nasÄ±l analiz edilir?",
    "{scenario} vakasÄ±nda risk iÅŸtahÄ± ve limitler nasÄ±l gÃ¶zden geÃ§irilmelidir?",
    "{scenario} karÅŸÄ±sÄ±nda hangi risk azaltma (mitigation) stratejileri uygulanabilir?",
    "{scenario} ile operasyonel ve itibar riskinin baÄŸlantÄ±sÄ±nÄ± aÃ§Ä±klar mÄ±sÄ±n?",
    "{scenario} senaryosunu ICAAP ve ILAAP Ã§erÃ§evesinde nasÄ±l raporlarÄ±z?"
]

# 3) TÃœM Ã–RNEKLERÄ° OLUÅTUR
examples = []

# Kavram bazlÄ± Ã¶rnekler
for topic, base_answer in concept_seeds:
    for template in concept_question_templates:
        q = template.format(topic=topic)
        examples.append(build_training_example(q, base_answer))

# Senaryo bazlÄ± Ã¶rnekler
for scenario, scen_answer in scenario_seeds:
    for template in scenario_question_templates:
        q = template.format(scenario=scenario)
        examples.append(build_training_example(q, scen_answer))

random.shuffle(examples)
print("âœ… Ãœretilen toplam eÄŸitim Ã¶rneÄŸi:", len(examples))

train_ds = Dataset.from_list(examples)

# 4) TOKENÄ°ZASYON
def tokenize_fn(batch):
    out = tokenizer(
        batch["text"],
        truncation=True,
        padding="max_length",
        max_length=512
    )
    out["labels"] = out["input_ids"].copy()
    return out

tokenized_train = train_ds.map(tokenize_fn, batched=True, remove_columns=["text"])

# 5) TRAINER AYARLARI (EÄÄ°TÄ°MÄ° SEN BAÅLATACAKSIN)
from transformers import TrainingArguments, Trainer

training_args = TrainingArguments(
    output_dir="RhoRisk-Meric-lora",
    per_device_train_batch_size=2,
    gradient_accumulation_steps=4,
    num_train_epochs=1,
    learning_rate=2e-4,
    fp16=True,
    logging_steps=20,
    save_strategy="epoch",
    optim="paged_adamw_8bit"
)

trainer = Trainer(
    model=model,
    args=training_args,
    train_dataset=tokenized_train,
)

# ğŸ”´ BÄ°LEREK YOK:
# trainer.train()
# model.save_pretrained("RhoRisk-Meric-lora")
# tokenizer.save_pretrained("RhoRisk-Meric-lora")
# BunlarÄ± istersen ayrÄ± bir hÃ¼crede sen Ã§aÄŸÄ±rÄ±rsÄ±n.

trainer.train()
model.save_pretrained("RhoRisk-Meric-lora")
tokenizer.save_pretrained("RhoRisk-Meric-lora")